# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

API —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –±–∞–∑–æ–≤—ã–º –ø—É—Ç—ë–º `/admin/api` (–ø–∞—Ä–∞–º–µ—Ç—Ä `basePath` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏). –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º –º–∞—Ä—à—Ä—É—Ç–∞–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ httpOnly JWT-cookie, –≤—ã–¥–∞–≤–∞–µ–º—É—é –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞. –î–ª—è –º—É—Ç–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è double-submit CSRF: —á–∏—Ç–∞–µ–º–∞—è cookie (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `admin_csrf`) –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º/—Ç–µ–ª–æ–º –∑–∞–ø—Ä–æ—Å–∞. –ò—Å–∫–ª—é—á–µ–Ω–∏—è ‚Äî `/health`, `/csrf` –∏ `GET /session`, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å       | –û–ø–∏—Å–∞–Ω–∏–µ                                                    |
| ------ | ---------- | ----------------------------------------------------------- |
| `GET`  | `/health`  | –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ (`{ status: "ok" }`)           |
| `GET`  | `/csrf`    | –í—ã–¥–∞—ë—Ç –Ω–æ–≤—ã–π CSRF-—Ç–æ–∫–µ–Ω –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç cookie `admin_csrf` |
| `GET`  | `/session` | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{ authenticated, username }`                    |
| `POST` | `/login`   | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (double-submit CSRF)          |
| `POST` | `/logout`  | –û—á–∏—Å—Ç–∫–∞ JWT-cookie –∏ CSRF                                   |

### –ü—Ä–∏–º–µ—Ä `POST /login`

```json
{
  "username": "admin",
  "password": "supersecret",
  "csrfToken": "<–∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ GET /csrf>"
}
```

> ‚ö†Ô∏è **–í–∞–∂–Ω–æ:** CSRF-—Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º, –≤—ã–¥–∞–Ω–Ω—ã–º `GET /csrf`, –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å—Å—è –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–µ —Å cookie.

## –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å                           | –û–ø–∏—Å–∞–Ω–∏–µ                                                    |
| ----- | ------------------------------ | ----------------------------------------------------------- |
| `GET` | `/stats/overview`              | –°–≤–æ–¥–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–Ω–∫–µ—Ç, –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å –∏ —Ç.–¥.) |
| `GET` | `/stats/demographics`          | –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ –ø–æ–ª—É, –≤–æ–∑—Ä–∞—Å—Ç—É, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–µ                 |
| `GET` | `/stats/timeline?rangeDays=30` | –¢–∞–π–º–ª–∞–π–Ω –∞–Ω–∫–µ—Ç –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ (1‚Äì365 –¥–Ω–µ–π)             |

## –ê–Ω–∫–µ—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å                              | –û–ø–∏—Å–∞–Ω–∏–µ                                     |
| ----- | --------------------------------- | -------------------------------------------- |
| `GET` | `/submissions?page=1&pageSize=25` | –ü–∞–≥–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∞–Ω–∫–µ—Ç —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏ |

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/submissions`

```json
{
  "items": [
    {
      "id": "clp2wjq1n0001z8kcy7p6c8p4",
      "createdAt": "2025-11-10T12:34:56.000Z",
      "profile": {
        "gender": "female",
        "age": 20,
        "fitnessLevel": "medium",
        "preferredFormats": ["group", "mixed"],
        "desiredGoals": ["endurance", "teamwork"],
        "avoidContact": false,
        "interestedInCompetition": true
      },
      "recommendations": [
        {
          "sectionId": "yoga",
          "sectionName": "–ô–æ–≥–∞",
          "score": 0.92,
          "rank": 1,
          "reasons": [
            {
              "kind": "similarity-goal",
              "tags": ["endurance"],
              "contribution": 0.62
            },
            { "kind": "contact-compatibility", "contribution": 0.31 }
          ]
        }
      ]
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 25,
    "total": 48,
    "totalPages": 2
  }
}
```

> üí° **–°–æ–≤–µ—Ç:** –∑–Ω–∞—á–µ–Ω–∏—è `page` –∏ `pageSize` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (`page ‚â• 1`, `5 ‚â§ pageSize ‚â§ 100`). `score` –≤—Å–µ–≥–¥–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ `0..1`, –ø–æ—Ç–æ–º—É —á—Ç–æ –±–µ—Ä—ë—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∫–æ—Å–∏–Ω—É—Å–Ω–æ–≥–æ —Å—Ö–æ–¥—Å—Ç–≤–∞.

## –°–µ–∫—Ü–∏–∏ (–ö–∞—Ç–∞–ª–æ–≥)

| –ú–µ—Ç–æ–¥    | –ü—É—Ç—å            | –û–ø–∏—Å–∞–Ω–∏–µ                     |
| -------- | --------------- | ---------------------------- |
| `GET`    | `/sections`     | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–µ–∫—Ü–∏–π  |
| `GET`    | `/sections/:id` | –ü–æ–ª—É—á–∏—Ç—å —Å–µ–∫—Ü–∏—é –ø–æ ID        |
| `POST`   | `/sections`     | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–µ–∫—Ü–∏—é         |
| `PUT`    | `/sections/:id` | –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å–µ–∫—Ü–∏—é |
| `DELETE` | `/sections/:id` | –£–¥–∞–ª–∏—Ç—å —Å–µ–∫—Ü–∏—é               |

### –ü—Ä–∏–º–µ—Ä —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞ (POST/PUT)

```json
{
  "id": "volleyball",
  "title": "–í–æ–ª–µ–π–±–æ–ª",
  "summary": "–ö–æ–º–∞–Ω–¥–Ω–∞—è –∏–≥—Ä–∞...",
  "focus": ["teamwork", "agility"],
  "format": "group",
  "contactLevel": "medium",
  "intensity": "high",
  "recommendedFor": { "fitness": ["medium", "high"] },
  "expectedResults": { "3months": "Basic skills" },
  "extraBenefits": ["Socializing"],
  "imagePath": "images/volleyball.jpg"
}
```

## –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å      | –û–ø–∏—Å–∞–Ω–∏–µ                                   |
| ------ | --------- | ------------------------------------------ |
| `POST` | `/upload` | –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (multipart/form-data) |

–û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏:

```json
{
  "success": true,
  "path": "1732100000000-image.jpg",
  "url": "/images/1732100000000-image.jpg"
}
```

## –û—à–∏–±–∫–∏

- 400 ‚Äî –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`Invalid payload`, `Invalid pagination parameters`).
- 401 ‚Äî –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –≤—Ö–æ–¥–µ.
- 403 ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π CSRF-—Ç–æ–∫–µ–Ω.
- 500 ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ (–ª–æ–≥–∏—Ä—É—é—Ç—Å—è Fastify).

## –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ —É—Ç–∏–ª–∏—Ç—ã

Frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `admin/web/src/api/client.ts` —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º `fetch` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è cookie. –î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –≤–Ω–µ—à–Ω–µ–π —Å–∏—Å—Ç–µ–º–æ–π —Å–ª–µ–¥—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å:

1. –ü–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞ (`GET /csrf`).
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ cookie –≤ `cookie jar`.
3. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é (`POST /login`).
4. –í—ã–∑–æ–≤—ã –∑–∞—â–∏—â—ë–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –ø–µ—Ä–µ–¥–∞—á–µ–π –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Content-Type: application/json` –∏ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞.
