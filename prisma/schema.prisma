generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}

enum Gender {
  male
  female
  unspecified
}

enum FitnessLevel {
  low
  medium
  high
}

enum TrainingFormat {
  individual
  group
  mixed
}

enum ContactLevel {
  nonContact
  lightContact
  fullContact
}

model SurveySubmission {
  id                       String                     @id @default(cuid())
  telegramUserId           String?
  chatId                   String?
  age                      Int
  gender                   Gender
  fitnessLevel             FitnessLevel
  preferredFormats         TrainingFormat[]
  desiredGoals             String[]
  avoidContact             Boolean
  interestedInCompetition  Boolean
  aiSummary                String?
  createdAt                DateTime                   @default(now())
  deletedAt                DateTime?
  recommendations          RecommendationSnapshot[]

  @@index([createdAt])
  @@index([gender])
  @@index([fitnessLevel])
  @@index([gender, fitnessLevel])
  @@index([createdAt, gender])
  @@index([telegramUserId])
  @@index([deletedAt])
}

model RecommendationSnapshot {
  id            String           @id @default(cuid())
  submission    SurveySubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  submissionId  String
  sectionId     String
  sectionName   String
  score         Float
  rank          Int
  reasons       Json?
  createdAt     DateTime         @default(now())

  @@index([submissionId, rank])
  @@index([sectionId])
  @@index([sectionId, score])
  @@index([createdAt])
}

model Session {
  key   String @id
  value String
}

model SportSection {
  id                   String          @id
  title                String
  summary              String
  focus                String[]
  format               TrainingFormat
  contactLevel         ContactLevel
  intensity            FitnessLevel
  recommendedFor       Json
  expectedResults      Json
  extraBenefits        String[]
  prerequisites        String?
  imagePath            String?
  locationHint         String?
  similarityVector     Json?
  recommendationCount  Int             @default(0)
  averageScore         Float?
  lastRecommendedAt    DateTime?
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  deletedAt            DateTime?

  @@index([format, intensity])
  @@index([contactLevel])
  @@index([deletedAt])
  @@index([recommendationCount])
}
