generator client {
  provider = "prisma-client"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}

model SurveySubmission {
  id                       String                     @id @default(cuid())
  telegramUserId           String?
  chatId                   String?
  age                      Int
  gender                   String
  fitnessLevel             String
  preferredFormats         String[]
  desiredGoals             String[]
  avoidContact             Boolean
  interestedInCompetition  Boolean
  aiSummary                String?
  createdAt                DateTime                   @default(now())
  recommendations          RecommendationSnapshot[]

  @@index([createdAt])
  @@index([gender])
  @@index([fitnessLevel])
}

model RecommendationSnapshot {
  id            String           @id @default(cuid())
  submission    SurveySubmission @relation(fields: [submissionId], references: [id], onDelete: Cascade)
  submissionId  String
  sectionId     String
  sectionName   String
  score         Float
  rank          Int
  reasons       Json?
  createdAt     DateTime         @default(now())

  @@index([submissionId, rank])
  @@index([sectionId])
}

model Session {
  key   String @id
  value String
}

model SportSection {
  id              String   @id
  title           String
  summary         String
  focus           String[]
  format          String
  contactLevel    String
  intensity       String
  recommendedFor  Json
  expectedResults Json
  extraBenefits   String[]
  prerequisites   String?
  imagePath       String?
  locationHint    String?
  similarityVector Json?
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
